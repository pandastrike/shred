<!DOCTYPE html>  <html> <head>   <title>examples.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="examples.html">                 examples.js               </a>                                           <a class="source" href="shred.html">                 shred.js               </a>                                           <a class="source" href="content.html">                 content.js               </a>                                           <a class="source" href="headers.html">                 headers.js               </a>                                           <a class="source" href="request.html">                 request.js               </a>                                           <a class="source" href="response.html">                 response.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               examples.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1>Introduction</h1>

<p>Shred is an HTTP client library intended to simplify the use of Node's
built-in HTTP library. In particular, we wanted to make it easier to interact
with HTTP-based APIs.</p>

<h1>A Simple Example</h1>

<p>Let's start simple. We're going to use the <a class="logo" href="/">spire<span
class="grey">.</span><span class="blue">io</span></a> API as our example.
Let's begin by getting the documentation for the API as HTML.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>First, we need to instantiate a Shred instance. We can re-use this instance
over any number of requests. The main purpose of creating an instance is to
make it possible for you to provide default options that will be applied
across each request for that instance. Later, we also expect to allow you to
manage connections on a per-instance basis.</p>

<p>For these examples, however, a simple Shred instance will work fine.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">Shred</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;shred&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">surf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Shred</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>We're going to check our responses with <code>assert</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">assert</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;assert&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>So now let's get that documentation:</p>

<p>We have to let the <a class="logo" href="/">spire<span
class="grey">.</span><span class="blue">io</span></a> API know that we want
the docs as HTML.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">surf</span><span class="p">.</span><span class="nx">get</span><span class="p">({</span>
  <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;http://api.spire.io&quot;</span><span class="p">,</span>
  <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">accept</span><span class="o">:</span> <span class="s2">&quot;text/html&quot;</span>
  <span class="p">},</span>
  <span class="nx">on</span><span class="o">:</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Response events can be specified in terms of response codes. More specific
events have precedence.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="mi">200</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">assert</span><span class="p">.</span><span class="nx">ok</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;√ Got API description as HTML&quot;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Here, <code>200</code> takes precedence over the more generic <code>response</code> event. This
allows us to avoid writing code like:</p>

<pre><code>if (response.status!=200) { // etc. 
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">response</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;We got something besides a 200 response!&quot;</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>We can also chain response handlers and have many handlers
for the generic 'response' event.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">surf</span><span class="p">.</span><span class="nx">get</span><span class="p">({</span>
  <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;http://api.spire.io&quot;</span><span class="p">,</span>
  <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">accept</span><span class="o">:</span> <span class="s2">&quot;text/html&quot;</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">assert</span><span class="p">.</span><span class="nx">ok</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;√ Got API description as HTML&quot;</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;We got something besides a 200 response!&quot;</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;I&#39;m not so happy about this non 200 response. Launch the missiles!&quot;</span><span class="p">);</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h1>Data Conversion</h1>

<p>Shred provides a very helpful facility for converting content entities to and
from Javascript data types. The conversion is based on the content type of the
entity.</p>

<p>Let's try asking for the API description as <code>application/json</code>:</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>First, let's declare a couple of variables we'll be using in later examples.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">resources</span><span class="p">,</span> <span class="nx">schema</span><span class="p">;</span>

<span class="nx">surf</span><span class="p">.</span><span class="nx">get</span><span class="p">({</span>
  <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;http://api.spire.io&quot;</span><span class="p">,</span>
  <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">accept</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span>
  <span class="p">},</span>
  <span class="nx">on</span><span class="o">:</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>This time, instead of asking for <code>response.content.body</code> we'll ask for
<code>response.content.data</code>. Since Shred knows we asked for JSON, it will
attempt to parse the response content as JSON.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="mi">200</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">assert</span><span class="p">.</span><span class="nx">ok</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>We can treat this as an ordinary Javascript object:</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">assert</span><span class="p">.</span><span class="nx">ok</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">sessions</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Let's save some of this for later.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">resources</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">resources</span><span class="p">;</span>
      <span class="nx">schema</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">schema</span><span class="p">[</span><span class="s2">&quot;1.0&quot;</span><span class="p">];</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;√ Got API description as JSON&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">response</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;We got something besides a 200 response!&quot;</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>We can do the same trick to <code>PUT</code> or <code>POST</code> a Javascript object. Let's go
ahead and use our session key to create a new session.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>This time, we're going to wrap our call to Shred in a function, so that we can
use it in a callback.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">createSession</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">surf</span><span class="p">.</span><span class="nx">post</span><span class="p">({</span>
    <span class="nx">url</span><span class="o">:</span> <span class="nx">resources</span><span class="p">.</span><span class="nx">sessions</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
    <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">accept</span><span class="o">:</span> <span class="nx">schema</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">mediaType</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Shred will automatically normalize the header names for you. Here,
<code>content_type</code> will be normalized to <code>Content-Type</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">content_type</span><span class="o">:</span> <span class="nx">schema</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">mediaType</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>This is the new bit. We just pass a Javascript object and Shred converts it
for us.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">content</span><span class="o">:</span> <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="s2">&quot;c9KfjaIirRlg9YKpCck97Q-1321321628&quot;</span> <span class="p">},</span>
    <span class="nx">on</span><span class="o">:</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>This time, we want a <code>201</code>, which means something (the session) was
created by the request. Again, we're freed from having to check the
response status.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="mi">201</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">assert</span><span class="p">.</span><span class="nx">ok</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>We'll save the session for future reference</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">resources</span><span class="p">.</span><span class="nx">session</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;√ Created a session.&quot;</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">response</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;We got something besides a 201 response!&quot;</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>  
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>We'll call it using <code>setTimeout</code> to make sure our <code>resources</code> and <code>schema</code>
variables are initialized properly in the return from the earlier <code>GET</code>.
Normally, you'd call this in its event handler.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">createSession</span><span class="p">,</span><span class="mi">1000</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h1>Error Handling</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Let's see how Shred error handling works. We'll attempt to create channel
using the <a class="logo" href="/">spire<span class="grey">.</span><span
class="blue">io</span></a> message service. However, we'll "forget" to include
an authorization header. This should give us back a <code>401: Unauthorized</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Now, we could simply handle this via the <code>response</code> event. We could also
handle it via the <code>401</code> event. But let's use the <code>error</code> event instead, just
for kicks.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">createChannel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">surf</span><span class="p">.</span><span class="nx">post</span><span class="p">({</span>
    <span class="nx">url</span><span class="o">:</span> <span class="nx">resources</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">channels</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Normally, we'd pass in a authorization header, too.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">accept</span><span class="o">:</span> <span class="nx">schema</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">mediaType</span><span class="p">,</span>
      <span class="nx">content_type</span><span class="o">:</span> <span class="nx">schema</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">mediaType</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>We'll try to create a channel named "foo".</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">content</span><span class="o">:</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;foo&quot;</span> <span class="p">},</span>
    <span class="nx">on</span><span class="o">:</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>The <code>error</code> event will fire on any response status above 400.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">assert</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">,</span><span class="mi">401</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;√ Handled channel create error.&quot;</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">response</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;We got something besides an error response!&quot;</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>  
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Again, you'd normally call this function in an event handler.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">createChannel</span><span class="p">,</span><span class="mi">2000</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>You can also handle redirects explicitly using the <code>redirect</code> event.
(Normally, Shred handles them for you.)</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <h1>Other Resources</h1>

<ul>
<li><strong>Code.</strong> Check out our <a href="https://github.com/spire-io/shred">GitHub
repository</a>. Don't hesitate to send us
pull requests!</li>
<li><strong>Bugs.</strong> Please file any <a href="https://github.com/spire-io/shred/issues">bugs or feature
requests</a>!</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 